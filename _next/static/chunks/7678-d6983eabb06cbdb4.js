"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7678],{2888:function(e,t,n){n.d(t,{Z:function(){return w}});var s=n(3827),i=n(4090),o=n(7907),a=n(9359),l=n(5677),r=n(7100),c=n(4081);function u(e){let{onClick:t}=e;return(0,s.jsx)("button",{onClick:t,className:"bg-blue-500 hover:bg-blue-600 text-white rounded-full w-12 h-12 flex items-center justify-center shadow-lg animate-pulse","aria-label":"Open chat assistant",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})})}function d(e){let{contextTitle:t,currentTask:n,onClose:i}=e;return(0,s.jsxs)("div",{className:"bg-blue-500 text-white px-4 py-4 flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"font-medium text-lg",children:n?"DoveText Virtual Assistant (".concat(n.currentStep,"/").concat(n.steps,")"):"DoveText Virtual Assistant (".concat(t,")")}),(0,s.jsx)("button",{onClick:i,className:"bg-blue-600 hover:bg-blue-700 text-white rounded-full p-1.5 flex items-center justify-center transition-colors cursor-pointer","aria-label":"Close chat",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}var h=n(336),m=n(7666),f=n(2393);function v(e){let{contextType:t="general",onSwitchContext:n,className:a="",enableNavigation:v=!1,enableChatTrigger:w=!0}=e,[p,g]=(0,i.useState)("");(0,o.useRouter)();let x=(0,r.useAction)(),b=(0,i.useRef)(null),{connectionId:k,connectionStatus:y,reconnectAttempts:C,MAX_AUTO_RECONNECT_ATTEMPTS:j,handleReconnect:T,chatHistory:N,currentTask:E,isProcessing:S,processingHint:L,showInputForm:D,isSending:R,isExpanded:A,animationState:I,isUserInitiated:M,addUserMessage:O,addSystemMessage:P,addErrorMessage:H,clearChatHistory:_,updateTask:z,handleInteractiveResponse:V,expandChat:Z,minimizeChat:B,sendMessage:F,setIsUserInitiated:U}=(0,c.useChat)(),Q=(0,i.useCallback)(()=>{if(0===N.length)return null;for(let e=N.length-1;e>=0;e--){let t=N[e];if("system"===t.type&&t.interactive&&!t.isResponseSubmitted)return t}return null},[N]);(0,i.useEffect)(()=>{A&&"open"===I&&b.current&&setTimeout(()=>{var e;null===(e=b.current)||void 0===e||e.focus()},100)},[A,I]);let W=(0,i.useCallback)(()=>{var e,n;return e=t,n=p,"schedule"===e?"Schedule":"tasks"===e?"Task":n.includes("/dashboard")?"Dashboard":n.includes("/notifications/delivery-methods")?"Delivery Methods":n.includes("/notifications")?"Notifications":n.includes("/user/profile")?"Profile":n.includes("/user/settings")?"Settings":"Assistant"},[t,p]),$=(0,i.useCallback)(()=>{var e,n;return e=t,n=p,"schedule"===e?'"Schedule a team meeting tomorrow"':"tasks"===e?'"Add a task to review the proposal"':n.includes("/dashboard")?'"Show me my upcoming schedule"':n.includes("/notifications/delivery-methods")?'"Create a new delivery method"':n.includes("/notifications")?'"Show me my notification settings"':n.includes("/user/profile")?'"Update my profile information"':n.includes("/user/settings")?'"Change my notification preferences"':'"Help me navigate to..."'},[t,p]),q=(0,i.useCallback)(e=>(function(e,t,n,s){let i=e.toLowerCase();if(t.includes("/dashboard")){if(/show.*schedule|view.*schedule|my schedule/i.test(i))return window.dispatchEvent(new CustomEvent("switchTab",{detail:{tab:0}})),s("I've switched to the Schedule tab for you."),!0;if(/show.*tasks|view.*tasks|my tasks/i.test(i))return window.dispatchEvent(new CustomEvent("switchTab",{detail:{tab:1}})),s("I've switched to the Tasks tab for you."),!0}return!!(t.includes("/notifications/delivery-methods")&&/add.*method|create.*method|new method/i.test(i))&&(n.setPendingAction("create-delivery-method"),s("I'm opening the dialog to create a new delivery method."),!0)})(e,p,x,P),[p,x,P]);(0,i.useEffect)(()=>{(null==E?void 0:E.complete)&&n&&n(t)},[E,n,t]),(0,i.useEffect)(()=>{g(window.location.pathname);let e=()=>{g(window.location.pathname)};return window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}},[]);let G=(0,i.useCallback)(()=>{let e=()=>{U(!0),B()};0===N.length||(null==E?void 0:E.complete)?e():confirm("Are you sure you want to close this conversation?")&&(_(),e())},[N,E,U,B,_]),J=(0,i.useCallback)(e=>{if(q(e))return;let n=Q();if(n&&!n.isResponseSubmitted){var s,i,o,a;let l;if(console.log("[TaskOrientedChat] Handling text input as response to interactive message:",n.id),(null===(s=n.interactiveData)||void 0===s?void 0:s.function)==="confirm"){console.log("[TaskOrientedChat] Text input not allowed for confirm interactions");return}if((null===(i=n.interactiveData)||void 0===i?void 0:i.function)==="present"){console.log("[TaskOrientedChat] Present interaction does not expect responses, treating as new message"),F(e,"chat",t);return}switch(null===(o=n.interactiveData)||void 0===o?void 0:o.function){case"select":let r=(null===(a=n.interactiveData.parameters)||void 0===a?void 0:a.options)||[],c=e.toLowerCase().trim(),u=r.map(e=>e.toLowerCase().trim()).findIndex(e=>e===c);u>=0?console.log("[TaskOrientedChat] Text input matched option:",l=r[u]):(l=e,console.log("[TaskOrientedChat] Text input did not match any option, using as custom input"));break;case"form":P("Please use the form interface to submit form data.");return;default:l=e}V(n.id||"interactive-".concat(Date.now()),l,t);return}F(e,"chat",t)},[F,t,q,Q,V,P]),K=(0,i.useCallback)((e,n)=>{V(e,n,t)},[V,t]),X=Q(),Y=(()=>{let e="fixed z-50 ".concat(a);return A||"closed"!==I?"".concat(e," inset-0 flex items-center justify-center bg-black bg-opacity-50"):"".concat(e," bottom-4 right-4 w-12 h-12")})(),ee=(()=>{let e="bg-white shadow-xl rounded-2xl w-11/12 md:w-3/4 lg:w-2/3 xl:w-1/2 max-w-4xl h-3/4 flex flex-col overflow-hidden";return A||"closed"!==I?"opening"===I||"closing"===I?"".concat(e," transform transition-all duration-300 ease-in-out ").concat("opening"===I?"scale-100 opacity-100":"scale-95 opacity-0"):e:"bg-white shadow-xl overflow-hidden rounded-full h-12 w-12"})();return A||"closed"!==I?(0,s.jsx)("div",{className:Y,onClick:e=>{e.target===e.currentTarget&&G()},children:(0,s.jsxs)("div",{className:ee,onClick:e=>e.stopPropagation(),style:{transformOrigin:"bottom right"},children:[(0,s.jsx)(d,{contextTitle:W(),currentTask:E,onClose:G}),A&&(0,s.jsx)(f.Q,{connectionStatus:y,onReconnect:T}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,s.jsx)(m.$,{chatHistory:N,isProcessing:S,processingHint:L,currentTask:E,getContextExample:$,onInteractiveResponse:K})}),"disconnected"===y&&C>=j&&(0,s.jsxs)("div",{className:"p-4 bg-red-50 border-t border-red-200",children:[(0,s.jsxs)("div",{className:"flex items-center text-red-800",children:[(0,s.jsx)(l.Z,{className:"h-5 w-5 mr-2"}),(0,s.jsx)("p",{children:"Connection lost. Unable to reconnect automatically."})]}),(0,s.jsx)("button",{onClick:T,className:"mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-md",children:"Try to reconnect manually"})]}),D&&(0,s.jsx)("div",{className:"mt-auto border-t",children:(0,s.jsx)(h.Z,{ref:b,onSubmit:J,isSending:R,showInputForm:D,currentTask:E,lastInteractiveMessage:X})})]})}):(0,s.jsx)("div",{className:Y,children:(0,s.jsx)(u,{onClick:()=>{U(!0),Z()}})})}function w(e){let{children:t}=e,{user:n,loading:l,needsValidation:r,isActive:c}=(0,a.useAuth)(),u=(0,o.useRouter)();if((0,i.useEffect)(()=>{l||(n?r?u.push("/auth/validate-email"):c||u.push("/auth/activate"):u.push("/signin"))},[n,l,r,c,u]),l)return(0,s.jsx)("div",{children:"Loading..."});if(!n||r||!c)return null;let d=(0,o.usePathname)(),h=(null==d?void 0:d.includes("/schedule"))?"schedule":(null==d?void 0:d.includes("/tasks"))?"automation":"general";return(0,s.jsxs)(s.Fragment,{children:[t,(0,s.jsx)(v,{contextType:h})]})}}}]);